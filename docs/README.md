# お守り在庫管理アプリ

神社のお守り在庫を、QRコードを使って簡単に管理するWebアプリです。

## 特徴

- **スマホ完結**: PCやサーバー不要、スマホのブラウザだけで動作
- **重複防止**: 同じ箱を2回スキャンしても数量が増えない安全設計
- **オフライン対応**: インターネット接続なしでも動作可能
- **CSV出力**: Airレジへの手入力を補助するCSVを出力

## 起動方法

### 方法1: ローカルで直接開く

1. `index.html` をダブルクリック
2. ブラウザで開きます

> ⚠️ 一部のブラウザではカメラが使えない場合があります。その場合は方法2を試してください。

### 方法2: ローカルサーバーで起動（推奨）

#### Pythonがある場合

```bash
# アプリのフォルダに移動
cd omamori-inventory-app

# サーバー起動
python -m http.server 8000

# ブラウザで開く
# http://localhost:8000
```

#### Node.jsがある場合

```bash
# npxでサーバー起動
npx serve .

# または
npx http-server .
```

### 方法3: スマホで使う

1. PCでローカルサーバーを起動
2. PCとスマホを同じWi-Fiに接続
3. PCのIPアドレスを確認（例: 192.168.1.100）
4. スマホのブラウザで `http://192.168.1.100:8000` を開く

## 使い方

### 1. モード選択

- **納品モード**: 新しく届いたお守りを登録
- **棚卸モード**: 現在の在庫を確認

### 2. QRスキャン

1. カメラが起動したら、お守りの箱に貼られたQRコードをスキャン
2. 読み取りに成功すると、商品名が表示されます
3. 同じQRを2回スキャンすると「重複警告」が表示されます（数量は増えません）

### 3. 集計・CSV出力

1. 「読み取り終了」ボタンを押す
2. 商品別の箱数・数量が表示されます
3. 「CSV出力」ボタンでファイルをダウンロード

## QRコードのフォーマット

```
[商品コード]-[年度(2桁)]-[箱連番(3桁)]

例:
HEALTH-25-001  → 健康守り 2025年 第1箱
MONEY-25-002   → 金運守り 2025年 第2箱
```

## 商品マスタ

デフォルトで以下の商品が登録されています：

| 商品コード | 商品名 | 入数 |
|-----------|--------|------|
| HEALTH | 健康守り | 50 |
| MONEY | 金運守り | 100 |
| LOVE | 縁結び守り | 80 |
| TRAFFIC | 交通安全守り | 60 |
| STUDY | 学業成就守り | 70 |
| FAMILY | 家内安全守り | 50 |
| BUSINESS | 商売繁盛守り | 60 |
| CHILD | 子授け守り | 40 |
| RECOVERY | 病気平癒守り | 50 |
| LUCK | 開運守り | 80 |

### マスタの変更方法

ブラウザの開発者コンソールから変更できます：

```javascript
// 現在のマスタを確認
omamoriApp.getMaster()

// マスタを更新
omamoriApp.setMaster({
    'HEALTH': { name: '健康守り', quantity: 50 },
    'MONEY': { name: '金運守り', quantity: 100 },
    // ... 他の商品
})

// デフォルトに戻す
omamoriApp.resetMaster()
```

## QRコードの作成方法

### Googleスプレッドシートで作成

1. A列に商品コード、B列に年度、C列に箱連番を入力
2. D列に `=A1&"-"&B1&"-"&TEXT(C1,"000")` でQRコードテキストを生成
3. E列に `=IMAGE("https://quickchart.io/qr?text="&ENCODEURL(D1)&"&size=100")` でQR画像を表示

### サンプルQRコード

`sample/sample-qr.html` を開くと、動作確認用のサンプルQRコードが表示されます。

## トラブルシューティング

### カメラが起動しない

- ブラウザのカメラ権限を確認してください
- HTTPSまたはlocalhostでアクセスしてください
- 別のブラウザ（Chrome推奨）を試してください

### QRが読み取れない

- 明るい場所で試してください
- QRコードを画面の中央に配置してください
- カメラのピントが合っているか確認してください

### CSVが文字化けする

- UTF-8 with BOMで出力しているため、通常は文字化けしません
- 古いExcelの場合は、「データ」→「テキストファイル」からインポートしてください

## 技術仕様

- **フロントエンド**: HTML5 + CSS3 + Vanilla JavaScript
- **QR読み取り**: html5-qrcode ライブラリ
- **データ保存**: localStorage（ブラウザ内）
- **CSV出力**: Blob + download属性

## ライセンス

MIT License

## 作成者

神社お守り在庫管理プロジェクト
