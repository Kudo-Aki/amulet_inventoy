# お守り在庫管理アプリ 運用ガイド

このガイドでは、お守り在庫管理アプリを実際のスマホで使用する方法と、日常の運用手順について説明します。

---

## 1. スマホで使えるようにする方法

### 方法A：PCをサーバーにしてスマホからアクセス（推奨）

この方法は、神社内のWi-Fi環境で使用する場合に最適です。

**必要なもの**
- Windows PC（またはMac）
- スマホ（iPhone / Android）
- 同じWi-Fiネットワーク

**手順**

1. **PCでアプリを起動する**

   zipファイルを解凍し、`app`フォルダを開きます。

   **Windowsの場合：**
   - `app`フォルダ内で、アドレスバーに `cmd` と入力してEnter
   - 黒い画面（コマンドプロンプト）が開きます
   - 以下を入力してEnter：
     ```
     python -m http.server 8080
     ```
   - 「Serving HTTP on 0.0.0.0 port 8080」と表示されれば成功

   **Macの場合：**
   - `app`フォルダを右クリック →「フォルダに新規ターミナル」
   - 以下を入力してEnter：
     ```
     python3 -m http.server 8080
     ```

2. **PCのIPアドレスを確認する**

   **Windowsの場合：**
   - 別のコマンドプロンプトを開く
   - `ipconfig` と入力してEnter
   - 「IPv4 アドレス」の数字をメモ（例：192.168.1.100）

   **Macの場合：**
   - システム環境設定 → ネットワーク → Wi-Fi
   - 「IPアドレス」の数字をメモ

3. **スマホからアクセスする**

   - スマホをPCと同じWi-Fiに接続
   - ブラウザ（Safari / Chrome）を開く
   - アドレス欄に入力：`http://192.168.1.100:8080`
     （数字はPCのIPアドレスに置き換え）
   - お守り在庫管理アプリが表示されます

4. **ホーム画面に追加（オプション）**

   **iPhoneの場合：**
   - Safariで開いた状態で、画面下の共有ボタン（□に↑）をタップ
   - 「ホーム画面に追加」をタップ
   - 名前を「お守り管理」などに変更して「追加」

   **Androidの場合：**
   - Chromeで開いた状態で、右上の「︙」をタップ
   - 「ホーム画面に追加」をタップ

---

### 方法B：スマホ単体で使う（オフライン対応）

インターネット接続なしで使いたい場合の方法です。

**手順**

1. zipファイルをスマホに転送（メール添付、Google Drive、AirDropなど）
2. zipを解凍
3. `app`フォルダ内の`index.html`をブラウザで開く

**注意：** 一部のブラウザではカメラが動作しない場合があります。その場合は方法Aをお試しください。

---

### 方法C：無料ホスティングサービスを使う

インターネット経由でどこからでもアクセスしたい場合の方法です。

**おすすめサービス**
- [GitHub Pages](https://pages.github.com/)（無料）
- [Netlify](https://www.netlify.com/)（無料）
- [Vercel](https://vercel.com/)（無料）

**GitHub Pagesの場合：**

1. GitHubアカウントを作成
2. 新しいリポジトリを作成（例：omamori-app）
3. `app`フォルダの中身をアップロード
4. Settings → Pages → Source を「main」に設定
5. 数分後、`https://あなたのユーザー名.github.io/omamori-app/` でアクセス可能

---

## 2. 実際の運用フロー

### 納品時の作業

```
1. 業者から荷物が届く
      ↓
2. アプリを開き「納品モード」を選択
      ↓
3. 各箱のQRコードをスキャン
   （同じ箱を2回読んでも大丈夫）
      ↓
4. すべての箱をスキャンしたら「読み取り終了」
      ↓
5. 集計結果を確認
      ↓
6. 「CSV出力」でファイル保存
      ↓
7. CSVの数量をAirレジに手入力
      ↓
8. 箱を倉庫に収納
```

### 棚卸時の作業

```
1. 棚卸日に倉庫へ行く
      ↓
2. アプリを開き「棚卸モード」を選択
      ↓
3. 倉庫内のすべての箱のQRコードをスキャン
      ↓
4. すべての箱をスキャンしたら「読み取り終了」
      ↓
5. 集計結果とAirレジの在庫を照合
      ↓
6. 差異があれば原因を調査
```

---

## 3. QRコードの準備

### QRコードのフォーマット

```
[商品コード]-[年度(2桁)]-[箱連番(3桁)]

例：
HEALTH-25-001  → 健康守り 2025年 第1箱
MONEY-25-002   → 金運守り 2025年 第2箱
```

### QRコードの作成方法

**方法1：Googleスプレッドシートで作成**

1. 新しいスプレッドシートを作成
2. 以下のように入力：

| A列（商品コード） | B列（年度） | C列（連番） | D列（QRテキスト） | E列（QR画像） |
|------------------|------------|------------|------------------|--------------|
| HEALTH | 25 | 1 | =A2&"-"&B2&"-"&TEXT(C2,"000") | =IMAGE("https://quickchart.io/qr?text="&ENCODEURL(D2)&"&size=100") |

3. D列とE列の数式を下にコピー
4. E列にQRコードが表示されます
5. 印刷してシールにする

**方法2：無料QRコード生成サイト**

- [QRコード作成サイト](https://www.qrcode-monkey.com/)
- 「HEALTH-25-001」などのテキストを入力
- ダウンロードして印刷

### QRコードシールの貼り方

- 各箱の側面（見えやすい位置）に貼る
- 1箱につき1枚のQRコード
- 同じ商品でも箱ごとに異なるQRコード

---

## 4. 商品マスタの変更方法

新しいお守りを追加したり、入数を変更する場合：

### 方法1：ブラウザのコンソールから変更

1. アプリを開いた状態で、F12キー（開発者ツール）を押す
2. 「Console」タブを選択
3. 以下のように入力：

```javascript
// 現在のマスタを確認
omamoriApp.getMaster()

// 新しい商品を追加
var master = omamoriApp.getMaster();
master['NEWITEM'] = { name: '新商品名', quantity: 50 };
omamoriApp.setMaster(master);

// 入数を変更
var master = omamoriApp.getMaster();
master['HEALTH'].quantity = 60;  // 健康守りを60個に変更
omamoriApp.setMaster(master);
```

### 方法2：app.jsファイルを直接編集

`js/app.js`ファイル内の`DEFAULT_MASTER`を編集：

```javascript
const DEFAULT_MASTER = {
    'HEALTH': { name: '健康守り', quantity: 50 },
    'MONEY': { name: '金運守り', quantity: 100 },
    // ここに新しい商品を追加
    'NEWITEM': { name: '新商品名', quantity: 50 }
};
```

---

## 5. トラブルシューティング

### カメラが起動しない

| 原因 | 対処法 |
|------|--------|
| カメラ権限が許可されていない | ブラウザの設定でカメラを許可 |
| HTTPでアクセスしている | HTTPSまたはlocalhostでアクセス |
| 古いブラウザ | Chrome/Safariの最新版を使用 |

### QRコードが読み取れない

| 原因 | 対処法 |
|------|--------|
| 暗い場所 | 明るい場所に移動 |
| QRコードが小さい | カメラを近づける |
| QRコードが汚れている | 汚れを拭き取る |
| ピントが合っていない | 少し離してみる |

### CSVが文字化けする

| 原因 | 対処法 |
|------|--------|
| 古いExcel | 「データ」→「テキストファイル」からインポート |
| 文字コード | UTF-8を指定してインポート |

---

## 6. 運用のコツ

### 効率的な作業のために

1. **QRコードは箱の同じ位置に貼る**
   - 探す手間が省けます

2. **納品時はその場でスキャン**
   - 後回しにすると忘れます

3. **定期的に棚卸を実施**
   - 月1回程度がおすすめ

4. **CSVは日付フォルダに保存**
   - 後から確認しやすくなります

### 注意点

- **同じ箱を2回スキャンしても数量は増えません**（安心設計）
- **ブラウザを閉じるとデータは消えます**（必ずCSV出力してから終了）
- **QRコードは箱ごとに一意にしてください**（同じQRを複数箱に貼らない）

---

## 7. お問い合わせ

運用中に問題が発生した場合は、担当者までご連絡ください。

---

*このガイドは、お守り在庫管理アプリ v1.0 に対応しています。*
